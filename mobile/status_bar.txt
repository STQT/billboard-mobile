# üìã STATUS BAR KODLARI - TO'LIQ PROMPT

## üéØ STATUS OVERLAY TUZILISHI

### 1. State Variables:
```dart
bool _showStatusOverlay = true;  // Status ko'rsatilsinmi
Duration _playPosition = Duration.zero;  // Hozirgi pozitsiya
Duration _playDuration = Duration.zero;  // Video davomiyligi
int? _lastPlayedVideoId;  // Oxirgi o'ynatilgan video ID (ketma-ket takrorlanishni oldini olish)
VideoPlayerController? _oldController;  // Smooth transition uchun eski controller
bool _isTransitioning = false;  // Video o'tish jarayonida (bir marta trigger)
Timer? _playlistRefreshTimer;  // Playlist yangilash timer
bool _isRefreshingPlaylist = false;  // Playlist yangilanmoqda
DateTime? _lastRefreshTime;  // Oxirgi yangilanish vaqti
```

### 2. Timer lar (initState ichida):

#### Status Update Timer:
```dart
_statusUpdateTimer = Timer.periodic(const Duration(milliseconds: 200), (_) {
  if (mounted && !_isDisposing && _controller != null && _controller!.value.isInitialized) {
    setState(() {
      _playPosition = _controller!.value.position;
      _playDuration = _controller!.value.duration;
    });
  }
});
```

#### Playlist Refresh Timer (har 1 minutda - TEZROQ):
```dart
_playlistRefreshTimer = Timer.periodic(const Duration(minutes: 1), (_) {
  if (mounted && !_isDisposing && !_isRefreshingPlaylist) {
    _refreshPlaylist();
  }
});
```

### 3. Helper Methods:
```dart
// Vaqtni formatlash (MM:SS)
String _formatDuration(Duration d) {
  final minutes = d.inMinutes.remainder(60).toString().padLeft(2, '0');
  final seconds = d.inSeconds.remainder(60).toString().padLeft(2, '0');
  return '$minutes:$seconds';
}

// Hozirgi soatni formatlash (HH:MM:SS)
String _formatCurrentTime() {
  final now = DateTime.now();
  return '${now.hour.toString().padLeft(2, '0')}:${now.minute.toString().padLeft(2, '0')}:${now.second.toString().padLeft(2, '0')}';
}

// Ma'lumot qatori
Widget _buildInfoRow(String label, String value, {Color? valueColor}) {
  return Padding(
    padding: const EdgeInsets.symmetric(vertical: 4),
    child: Row(
      children: [
        Expanded(
          flex: 2,
          child: Text(
            label,
            style: const TextStyle(color: Colors.white70, fontSize: 14),
          ),
        ),
        Expanded(
          flex: 3,
          child: Text(
            value,
            style: TextStyle(
              color: valueColor ?? Colors.white,
              fontSize: 14,
              fontWeight: FontWeight.w500,
            ),
          ),
        ),
      ],
    ),
  );
}
```

## üì± STATUS OVERLAY UI (build method ichida):

### Asosiy Overlay (TO'LIQ VERSIYA):
```dart
if (_showStatusOverlay)
  Positioned.fill(
    child: GestureDetector(
      onTap: () => setState(() => _showStatusOverlay = false),  // Bosish bilan yopish
      child: Container(
        color: Colors.black.withOpacity(0.85),  // Shaffof fon
        child: Consumer<VideoService>(
          builder: (context, videoService, _) {
            final usePlayItems = videoService.usePlayItems;
            final playList = videoService.playList;
            final videos = videoService.videos;
            final idx = videoService.currentVideoIndex;
            final total = usePlayItems ? playList.length : videos.length;
            final v = _currentVideo;
            final item = _currentPlayItem;
            
            // Keyingi video
            final nextIndex = (idx + 1) % total;
            final nextItem = usePlayItems && playList.isNotEmpty 
                ? playList[nextIndex] 
                : null;
            final nextVideo = !usePlayItems && videos.isNotEmpty 
                ? videos[nextIndex] 
                : null;

            // Contract yoki Filler ekanligini aniqlash
            bool isCurrentContract = false;
            bool isNextContract = false;
            if (usePlayItems && videoService.currentPlaylist != null) {
              final contractVideoIds = videoService.currentPlaylist!.contractVideos
                  .map((c) => c.videoId)
                  .toSet();
              if (item != null) {
                isCurrentContract = contractVideoIds.contains(item.videoId);
              }
              if (nextItem != null) {
                isNextContract = contractVideoIds.contains(nextItem.videoId);
              }
            }

            return SafeArea(
              child: SingleChildScrollView(
                padding: const EdgeInsets.all(16),
                child: Column(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                    // 1Ô∏è‚É£ HEADER
                    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                    const Text(
                      'üé¨ Billboard Player Status',
                      style: TextStyle(
                        color: Colors.white,
                        fontSize: 20,
                        fontWeight: FontWeight.bold,
                      ),
                    ),
                    const SizedBox(height: 16),

                    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                    // 2Ô∏è‚É£ HOZIRGI VAQT VA POZITSIYA
                    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                    _buildInfoRow('üïê Soat', _formatCurrentTime(DateTime.now())),
                    _buildInfoRow('üìç Pozitsiya', '${idx + 1} / $total'),
                    _buildInfoRow('üéØ Rejim', usePlayItems ? 'Contract + Filler' : 'Video Sequence'),
                    
                    const Divider(color: Colors.white38, height: 24),

                    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                    // 3Ô∏è‚É£ HOZIRGI VIDEO MA'LUMOTLARI
                    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                    Row(
                      children: [
                        Text(
                          isCurrentContract
                              ? 'üì∫ Contract Video'
                              : 'üéûÔ∏è ${usePlayItems ? "Filler Video" : "Video"}',
                          style: TextStyle(
                            color: isCurrentContract
                                ? Colors.green
                                : Colors.orange,
                            fontSize: 16,
                            fontWeight: FontWeight.bold,
                          ),
                        ),
                      ],
                    ),
                    const SizedBox(height: 8),
                    
                    if (item != null) ...[
                      _buildInfoRow('Video ID', item.videoId.toString()),
                      _buildInfoRow('Pozitsiya', _formatDuration(_playPosition)),
                      _buildInfoRow('Duration', _formatDuration(_playDuration)),
                      if (isCurrentContract)
                        _buildInfoRow(
                          'Segment',
                          '${item.startTime.toStringAsFixed(1)}s - ${item.endTime.toStringAsFixed(1)}s',
                        ),
                    ] else if (v != null) ...[
                      _buildInfoRow('Video ID', v.id.toString()),
                      _buildInfoRow('Nomi', v.title),
                      _buildInfoRow('Pozitsiya', _formatDuration(_playPosition)),
                      _buildInfoRow('Duration', _formatDuration(_playDuration)),
                    ],

                    if (_failedVideoIds.isNotEmpty) ...[
                      const SizedBox(height: 8),
                      _buildInfoRow('‚ùå O\'tkazilgan', '${_failedVideoIds.length} ta', valueColor: Colors.red),
                    ],

                    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                    // 4Ô∏è‚É£ KEYINGI VIDEO
                    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                    if (nextItem != null || nextVideo != null) ...[
                      const Divider(color: Colors.white38, height: 24),
                      Container(
                        padding: const EdgeInsets.all(12),
                        decoration: BoxDecoration(
                          color: Colors.blue.withOpacity(0.2),
                          border: Border.all(color: Colors.blue, width: 2),
                          borderRadius: BorderRadius.circular(8),
                        ),
                          child: Column(
                            crossAxisAlignment: CrossAxisAlignment.start,
                            children: [
                              Text(
                                isNextContract
                                    ? '‚è≠Ô∏è Keyingi Contract Video'
                                    : '‚è≠Ô∏è Keyingi ${usePlayItems ? "Filler" : "Video"}',
                                style: const TextStyle(
                                  color: Colors.blue,
                                  fontSize: 16,
                                  fontWeight: FontWeight.bold,
                                ),
                              ),
                              const SizedBox(height: 8),
                              if (nextItem != null) ...[
                                _buildInfoRow('Video ID', nextItem.videoId.toString()),
                                _buildInfoRow(
                                  'Duration',
                                  '${(nextItem.endTime - nextItem.startTime).toStringAsFixed(1)}s',
                                ),
                                if (isNextContract)
                                  _buildInfoRow(
                                    'Segment',
                                    '${nextItem.startTime.toStringAsFixed(1)}-${nextItem.endTime.toStringAsFixed(1)}s',
                                  ),
                              _buildInfoRow(
                                '‚è±Ô∏è Boshlanadi',
                                '${(_playDuration.inMilliseconds / 1000 - _playPosition.inMilliseconds / 1000).toStringAsFixed(1)}s ichida',
                                valueColor: Colors.greenAccent,
                              ),
                            ] else if (nextVideo != null) ...[
                              _buildInfoRow('Video ID', nextVideo.id.toString()),
                              _buildInfoRow('Nomi', nextVideo.title),
                              _buildInfoRow(
                                '‚è±Ô∏è Boshlanadi',
                                '${(_playDuration.inMilliseconds / 1000 - _playPosition.inMilliseconds / 1000).toStringAsFixed(1)}s ichida',
                                valueColor: Colors.greenAccent,
                              ),
                            ],
                          ],
                        ),
                      ),
                    ],

                    const Divider(color: Colors.white38, height: 24),

                    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                    // 5Ô∏è‚É£ PLAYLIST STATISTIKA
                    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                    const Text(
                      'üìä Playlist Statistika',
                      style: TextStyle(
                        color: Colors.white,
                        fontSize: 16,
                        fontWeight: FontWeight.bold,
                      ),
                    ),
                    const SizedBox(height: 8),
                    if (usePlayItems) ...[
                      _buildInfoRow('Contract', '${videoService.currentPlaylist?.contractVideos.length ?? 0} ta'),
                      _buildInfoRow('Filler', '${videoService.currentPlaylist?.fillerVideos.length ?? 0} ta'),
                    ] else ...[
                      _buildInfoRow('Videolar', '$total ta'),
                    ],
                    _buildInfoRow('Jami', '$total ta video'),
                    _buildInfoRow('üíæ Rejim', 'OFFLINE-READY', valueColor: Colors.greenAccent),

                    const SizedBox(height: 24),

                    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                    // 6Ô∏è‚É£ YOPISH TUGMASI
                    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                    Center(
                      child: Container(
                        padding: const EdgeInsets.symmetric(
                          horizontal: 16,
                          vertical: 8,
                        ),
                        decoration: BoxDecoration(
                          color: Colors.white.withOpacity(0.2),
                          borderRadius: BorderRadius.circular(8),
                        ),
                        child: const Row(
                          mainAxisSize: MainAxisSize.min,
                          children: [
                            Icon(Icons.touch_app, color: Colors.white, size: 20),
                            SizedBox(width: 8),
                            Text(
                              'Yopish uchun bosing',
                              style: TextStyle(color: Colors.white),
                            ),
                          ],
                        ),
                      ),
                    ),
                  ],
                ),
              ),
            );
          },
        ),
      ),
    ),
  ),
```

## üü¢ STATUS TOGGLE BUTTON (yopilgan holatda - KICHIK VA TRANSPARENT):

```dart
if (!_showStatusOverlay)
  Positioned(
    right: 12,
    top: 12,
    child: GestureDetector(
      onTap: () => setState(() => _showStatusOverlay = true),  // Bosish bilan ochish
      child: Container(
        padding: const EdgeInsets.all(6),  // 12 ‚Üí 6 (yarim barobar kichik)
        decoration: BoxDecoration(
          color: Colors.black.withOpacity(0.3),  // 0.7 ‚Üí 0.3 (shaffofroq)
          border: Border.all(color: Colors.green.withOpacity(0.6), width: 1),  // 2 ‚Üí 1, shaffof
          borderRadius: BorderRadius.circular(6),  // 8 ‚Üí 6
          boxShadow: [
            BoxShadow(
              color: Colors.green.withOpacity(0.2),  // 0.5 ‚Üí 0.2 (kamroq glow)
              blurRadius: 4,  // 10 ‚Üí 4
              spreadRadius: 1,  // 2 ‚Üí 1
            ),
          ],
        ),
        child: const Row(
          mainAxisSize: MainAxisSize.min,
          children: [
            Icon(Icons.info_outline, color: Colors.green, size: 14),  // 24 ‚Üí 14
            SizedBox(width: 4),  // 8 ‚Üí 4
            Text(
              'Status',
              style: TextStyle(
                color: Colors.white70,  // white ‚Üí white70 (shaffofroq)
                fontSize: 10,  // 16 ‚Üí 10
                fontWeight: FontWeight.w500,  // bold ‚Üí w500
              ),
            ),
          ],
        ),
      ),
    ),
  ),
```

## üé® RANGLI SCHEME:

- **Header**: Oq, bold, katta (fontSize: 20)
- **Current Video**: Yashil (contract) / To'q sariq (filler/video)
- **Next Video**: Ko'k border, ko'k background (opacity: 0.2)
- **Stats**: Oq matn
- **Toggle Button**: Qora fon, yashil border, yashil glow effect
- **Info Row**: Label - white70, Value - white (yoki custom color) + fontWeight.w500
- **Failed Videos**: Qizil rang
- **Offline Ready**: Yashil accent rang

## üíæ OFFLINE REJIM (CACHE):

VideoService avtomatik ravishda barcha videolarni cache qiladi:

```dart
// VideoService ichida
Future<void> _cacheVideos() async {
  for (var video in _videos) {
    try {
      final videoUrl = '${ApiService.baseUrl.replaceAll('/api/v1', '')}${video.filePath}';
      await _cacheManager.downloadFile(videoUrl);
    } catch (e) {
      debugPrint('Error caching video ${video.id}: $e');
    }
  }
}

Future<void> _cachePlayListUrls() async {
  for (var item in _playList) {
    try {
      await _cacheManager.downloadFile(item.mediaUrl);
    } catch (e) {
      debugPrint('Error caching ${item.mediaUrl}: $e');
    }
  }
}
```

Video olishda avval cache'dan tekshiriladi:

```dart
Future<String> getVideoUrl(Video video) async {
  final videoUrl = '${ApiService.baseUrl.replaceAll('/api/v1', '')}${video.filePath}';
  try {
    final fileInfo = await _cacheManager.getFileFromCache(videoUrl);
    if (fileInfo != null) return fileInfo.file.path;  // Cache'dan
    final file = await _cacheManager.getSingleFile(videoUrl);  // Download qilish
    return file.path;
  } catch (e) {
    return videoUrl;  // Network URL qaytarish
  }
}
```

## üîÑ AVTOMATIK PLAYLIST YANGILASH:

### App Lifecycle Hook (foreground ga qaytganda):
```dart
@override
void didChangeAppLifecycleState(AppLifecycleState state) {
  if (_isDisposing) return;
  switch (state) {
    case AppLifecycleState.resumed:
      _applyImmersiveAndKiosk();
      // App foreground ga qaytganda playlist ni yangilash
      if (!_isRefreshingPlaylist) {
        Future.delayed(const Duration(seconds: 2), () {
          if (mounted && !_isDisposing) {
            _refreshPlaylist();
          }
        });
      }
      break;
    // ...
  }
}
```

### Playlist Refresh Metodi (YAXSHILANGAN):
```dart
Future<void> _refreshPlaylist() async {
  if (_isDisposing || !mounted || _isRefreshingPlaylist) return;
  
  _isRefreshingPlaylist = true;
  
  try {
    final videoService = context.read<VideoService>();
    
    // Eski playlist ma'lumotlari
    final oldPlaylistId = videoService.currentPlaylist?.id;
    final oldTotalVideos = videoService.usePlayItems 
        ? videoService.playList.length 
        : videoService.videos.length;
    final currentVideoId = _currentVideo?.id ?? _currentPlayItem?.videoId;
    
    debugPrint('üîÑ Refreshing playlist...');
    debugPrint('   Old Playlist ID: $oldPlaylistId');
    debugPrint('   Old Total Videos: $oldTotalVideos');
    
    // Playlist ni yangilash (API dan yangi ma'lumot olish)
    await videoService.loadPlaylist();
    
    // Yangi playlist ma'lumotlari
    final newPlaylistId = videoService.currentPlaylist?.id;
    final newTotalVideos = videoService.usePlayItems 
        ? videoService.playList.length 
        : videoService.videos.length;
    
    debugPrint('‚úÖ Playlist refreshed successfully!');
    debugPrint('   New Playlist ID: $newPlaylistId');
    debugPrint('   New Total Videos: $newTotalVideos');
    
    // Agar playlist o'zgardi yoki yangi videolar qo'shildi
    if (oldPlaylistId != newPlaylistId || oldTotalVideos != newTotalVideos) {
      debugPrint('üÜï PLAYLIST CHANGED!');
      debugPrint('   Playlist ID changed: ${oldPlaylistId != newPlaylistId}');
      debugPrint('   Video count changed: ${oldTotalVideos != newTotalVideos}');
      
      // Failed videolar ro'yxatini tozalash
      _failedVideoIds.clear();
      
      // Agar hozirgi video yangi playlist da bo'lmasa, boshidan boshlash
      final currentExists = videoService.usePlayItems
          ? videoService.playList.any((item) => item.videoId == currentVideoId)
          : videoService.videos.any((v) => v.id == currentVideoId);
          
      if (!currentExists && currentVideoId != null) {
        debugPrint('‚ö†Ô∏è Current video not in new playlist, restarting...');
        await _initialize();
      }
    }
    
    // Oxirgi yangilanish vaqtini saqlash
    _lastRefreshTime = DateTime.now();
    
    if (mounted) {
      setState(() {});
    }
  } catch (e) {
    debugPrint('‚ùå Error refreshing playlist: $e');
  } finally {
    _isRefreshingPlaylist = false;
  }
}
```

### Xususiyatlari:
- ‚úÖ **Har 1 minutda** avtomatik yangilanadi (5 minutdan tezroq!)
- ‚úÖ **App foreground ga qaytganda** ham yangilanadi
- ‚úÖ Hozirgi video o'ynashda davom etadi (uzilmaydi)
- ‚úÖ Yangi videolar backend dan yuklanadi
- ‚úÖ **Playlist ID o'zgarishini aniqlaydi**
- ‚úÖ **Video soni o'zgarishini aniqlaydi**
- ‚úÖ **Aniq loglar** - qanday o'zgarish bo'lganini ko'rsatadi
- ‚úÖ Agar hozirgi video yangi playlist da bo'lmasa, qaytadan boshlaydi
- ‚úÖ Cache yangilanadi
- ‚úÖ Failed videolar ro'yxati tozalanadi
- ‚úÖ Background da ishlaydi
- ‚úÖ **Status bar da oxirgi yangilanish vaqti** ko'rsatiladi

## üîß DISPOSE METHOD:

```dart
@override
void dispose() {
  _isDisposing = true;
  
  // Barcha timer larni bekor qilish
  _statusUpdateTimer?.cancel();
  _statusUpdateTimer = null;
  _playlistRefreshTimer?.cancel();  // ‚Üê Playlist refresh timer ham bekor qilinadi
  _playlistRefreshTimer = null;
  
  WidgetsBinding.instance.removeObserver(this);
  WakelockPlus.disable();
  stopKioskMode();
  
  _controller?.dispose();
  _oldController?.dispose();
  
  super.dispose();
}
```

## üìå MUHIM ESLATMALAR:

1. **Consumer<VideoService>** ishlatiladi - VideoService real-time listen qilinadi
2. **GestureDetector** - overlay ga bosish bilan yopiladi
3. **SingleChildScrollView** - agar ma'lumot ko'p bo'lsa scroll bo'ladi
4. **SafeArea** - statusbar va navigation bar bilan to'qnashmaydi
5. **Timer.periodic** - har 200ms da pozitsiya yangilanadi
6. **isCurrentContract va isNextContract** - video turi aniqlanadi (playlist contractVideos ro'yxatidan)
   ```dart
   final contractVideoIds = videoService.currentPlaylist!.contractVideos
       .map((c) => c.videoId)
       .toSet();
   isCurrentContract = contractVideoIds.contains(item.videoId);
   ```

## üîÑ VIDEO TAKRORLANISHNI OLDINI OLISH:

### Video Looping OFF:
```dart
_controller!.setLooping(false);  // Video looping o'chirilgan
```

### Video Duration Tracking (300ms oldin o'tish):
```dart
_videoEndListener = () {
  if (_controller == null || !_controller!.value.isInitialized) return;
  final position = _controller!.value.position;
  final duration = _controller!.value.duration;
  
  // 300ms oldin keyingi videoga o'tish (smooth transition)
  if (duration > Duration.zero && position >= duration - const Duration(milliseconds: 300)) {
    _onVideoEnded();
  }
};
```

### Ketma-ket Takrorlanishni Oldini Olish:
```dart
// _findNextPlayableVideo va _findNextPlayableItem funksiyalarida:
final shouldSkipBecauseSameAsLast = 
    videos.length > 1 && _lastPlayedVideoId != null && video.id == _lastPlayedVideoId;

if (!_failedVideoIds.contains(video.id) && !shouldSkipBecauseSameAsLast) {
  // Video o'ynatish
}
```

### Oxirgi Video ID Saqlash:
```dart
_lastPlayedVideoId = video.id;  // yoki item.videoId
```

## üé¨ SMOOTH TRANSITION (Uzilishsiz Video O'tish):

### Dual Controller Strategy:
Videolar orasida uzilish bo'lmasligi uchun ikkita controller ishlatiladi:
- `_controller` - hozirgi video
- `_oldController` - oldingi video (transition vaqtida)

### Video O'tish Jarayoni:
```dart
// 1. Eski controller ni saqlash
_oldController = _controller;
_controller = null;

// 2. Yangi controller yaratish va initialize qilish
_controller = VideoPlayerController.file(File(videoUrl));
await _controller!.initialize();
await _controller!.play();

// 3. Tayyor bo'lganda eski controller ni dispose qilish
if (_oldController != null) {
  _oldController!.dispose();
  _oldController = null;
}
```

### Bir Marta Trigger (Listener Protection):
```dart
bool _isTransitioning = false;  // Flag

void _onVideoEnded() {
  if (_isDisposing || !mounted || _isTransitioning) return;
  _isTransitioning = true;  // Faqat bir marta
  
  videoService.nextVideo();
  _playCurrentVideo();
}

// Video tayyor bo'lganda:
_isTransitioning = false;
```

### Afzalliklari:
‚úÖ Videolar orasida qora ekran yo'q
‚úÖ Smooth transition - uzilishsiz o'tish
‚úÖ Eski video frame ko'rsatiladi, yangi video tayyorlanayotganda
‚úÖ 300ms oldin keyingi video boshlanadi
‚úÖ Listener bir marta trigger bo'ladi

## üéØ FUNKSIONALLIK:

‚úÖ Real-time pozitsiya tracking
‚úÖ Hozirgi video haqida TO'LIQ ma'lumot (ID, pozitsiya, duration, segment)
‚úÖ Keyingi video haqida TO'LIQ ma'lumot (ID, duration, qancha vaqtdan keyin boshlanishi)
‚úÖ Contract/Filler to'g'ri aniqlash (contractVideos ro'yxatidan)
‚úÖ Failed videolar soni (qizil rangda)
‚úÖ Playlist statistika (contract, filler, jami videolar)
‚úÖ Offline rejim ko'rsatiladi (OFFLINE-READY)
‚úÖ Tap to show/hide
‚úÖ Chiroyli, to'liq ekranli UI dizayn
‚úÖ Video looping o'chirilgan (takrorlanmaydi)
‚úÖ Videolar o'z duration da o'ynaydi
‚úÖ Ketma-ket bir xil video o'ynamaydi
‚úÖ Start va end timelarda videolar qo'yiladi
‚úÖ **UZILISHSIZ VIDEO O'TISH** - videolar orasida qora ekran yo'q
‚úÖ **SMOOTH TRANSITION** - dual controller strategy
‚úÖ 300ms oldin keyingi video boshlanadi
‚úÖ Listener bir marta trigger bo'ladi
‚úÖ **AVTOMATIK PLAYLIST YANGILASH** - har 1 minutda serverdan yangi videolar tekshiriladi
‚úÖ **App foreground ga qaytganda** ham avtomatik yangilanadi
‚úÖ Yangi videolar qo'shilganda avtomatik cache qilinadi va o'ynatiladi
‚úÖ Playlist ID va video soni o'zgarishini aniqlaydi
‚úÖ Aniq loglar - qanday o'zgarish bo'lganini ko'rsatadi
‚úÖ Hozirgi video uzilmaydi, background da yangilanadi
‚úÖ Status bar da oxirgi yangilanish vaqti ko'rsatiladi

---

File location: c:\Users\user\project\billboard-mobile\mobile\lib\screens\video_player_screen.dart
Lines: 440-762 (Status overlay), 51-77 (State & Timer), 457-466 (Helper methods), 734-755 (_buildInfoRow)
